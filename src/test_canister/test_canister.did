/* WebSocket types */
type ClientPrincipal = principal;
type GatewayPrincipal = principal;
type ClientKey = record {
    client_principal : ClientPrincipal;
    client_nonce : nat64;
};

type WebsocketMessage = record {
    client_key : ClientKey;
    sequence_num : nat64;
    timestamp : nat64;
    is_service_message : bool;
    content : blob;
};

type CanisterOutputMessage = record {
    client_key : ClientKey;
    key : text;
    content : blob;
};

type CanisterOutputCertifiedMessages = record {
    messages : vec CanisterOutputMessage;
    cert : blob;
    tree : blob;
    is_end_of_queue : bool;
};

type CanisterWsOpenArguments = record {
    client_nonce : nat64;
    gateway_principal : GatewayPrincipal;
};

type CanisterWsOpenResult = variant {
    Ok : null;
    Err : text;
};

type CanisterWsCloseArguments = record {
    client_key : ClientKey;
};

type CanisterWsCloseResult = variant {
    Ok : null;
    Err : text;
};

type CanisterWsMessageArguments = record {
    msg : WebsocketMessage;
};

type CanisterWsMessageResult = variant {
    Ok : null;
    Err : text;
};

type CanisterWsGetMessagesArguments = record {
    nonce : nat64;
};

type CanisterWsGetMessagesResult = variant {
    Ok : CanisterOutputCertifiedMessages;
    Err : text;
};
/* End WebSocket types */

/* Application types */
type HttpRequestId = nat32;

type HttpMethod = variant {
    GET;
    POST;
    PUT;
    HEAD;
    DELETE;
};

type HttpHeader = record {
    name : text;
    value : text;
};

type AppMessage = record {
    text : text;
};

service : () -> {
  "execute_http_request" : (text, HttpMethod, vec HttpHeader, opt text) -> (HttpRequestId);
  "get_logs" : () -> (vec record { text; text }) query;
  "ws_open" : (CanisterWsOpenArguments) -> (CanisterWsOpenResult);
  "ws_close" : (CanisterWsCloseArguments) -> (CanisterWsCloseResult);
  "ws_message" : (CanisterWsMessageArguments, opt AppMessage) -> (CanisterWsMessageResult);
  "ws_get_messages" : (CanisterWsGetMessagesArguments) -> (CanisterWsGetMessagesResult) query;
};
